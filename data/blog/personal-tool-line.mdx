---
title: เมื่ออยากมี Tools ส่วนตัวใช้ในชีวิตประจำวันผ่าน LINE
date: "2023-05-30"
tags: ["node", "line", "android", "googlecloud"]
draft: true
summary: ""
layout: PostSimple
featureImage: "/static/images/blog/personal-tool-line/cover.png"
---

<center>![Cover](/static/images/blog/personal-tool-line/cover.png)</center>
<center className="text-xs">
  ขอบคุณรูปภาพจาก
  [https://bs-uploads.toptal.io](https://bs-uploads.toptal.io/blackfish-uploads/components/seo/content/og_image_file/og_image/1020542/chatbot-fails-b7e2373d46845ca189f736687c435770.png)
</center>

จุดเริ่มต้นทั้งหมดเริ่มจากผมได้ไปดู Video ของคุณ [dtinth](https://dt.in.th/) ชื่อ Video ว่า [Let’s build a personal assistant bot and level up your coding skills!](https://youtu.be/IdFX7nwD744)
เมื่อผมดูจนจบ ผมสนใจมากๆ(ผมจะตื่นเต้นกับอะไรที่ผมไม่เคยทำ) และผมได้เริ่มทำมันทันที !!

ซึ่งบทความนี้จะเป็นการพูดภาพรวมทั้งหมดหลังจากที่ผมหมกมุ่นกับมันอยู่สักพัก เล่าว่าทำอะไรไปบ้าง และแต่ล่ะอย่างทำงานอย่างไร โดยจะแยกลงลึกในแต่ล่ะเรื่องเป็นแต่ล่ะบทความไปเลย
เพื่อไม่ให้บทความนี้ยาวจนเกินไป

## ทำอะไรไปบ้าง ?

<center>![Cover](/static/images/blog/personal-tool-line/maping.png)</center>

### Jasistant (Custom Service)

ผมเขียน Service ขึ้นมาเองด้วย Node.js และใช้ Host เป็น [Vercel](https://vercel.com/) เป็นตัวกลางที่รวม Logic ทุกอย่าง

<br />

<center>. . .</center>

<br />

### Janalyze (Line Bot)
เปรียบเสมือนผู้ช่วยส่วนตัวที่คอยรับคำสั่งง่ายๆ ตามที่เรากำหนด โดยเชื่อมต่อกับ **Jasistant** ผ่าน **Webhook** ใน **Messaging API** สามารถทำงานได้ดังนี้

1. **Expense record** - แน่นอนว่าทุกวันนี้มีแอปบันทึกรายรับ-รายจ่ายเต็มไปหมด แต่การบันทึกแต่ล่ะรายการนั้น
  ต้องทำอย่างน้อย 2-3 step และมีหลายอย่างที่ต้องกรอก แต่ Line Bot ของผมแค่พิมพ์สั้นๆ เช่น พิมพ์ว่า "60f" เป็นการบอกว่า จ่ายค่าอาหารไป 60 บาทนะ
  และ Bot จะตอบกลับมาโดยสามารถคลิกเข้าไปแก้ไขข้อมูลได้ผ่าน [Airtable](https://www.airtable.com/)

| คำสั่ง "60f"                                         | คำสั่ง "145d startbuck"                               |
| ---------------------------------------------------- | ----------------------------------------------------- |
| ![60f](/static/images/blog/personal-tool-line/60f.jpg) | ![145d](/static/images/blog/personal-tool-line/145d.jpg) |

| Airtable(Rows)                                            | Airtable(Detail)                                            |
| --------------------------------------------------------- | ----------------------------------------------------------- |
| ![Airtable Rows](/static/images/blog/personal-tool-line/airtable.jpg) | ![Airtable Detail](/static/images/blog/personal-tool-line/air-detail.jpg) |

2. **QR Code Promptpay** - ทำได้ง่ายๆ ถ้าอยากได้ QR ที่เป็น 100 บาท ก็พิมพ์ว่า "qr100" ก็จะได้ QR Code ที่ล็อคจำนวนเงินไว้ให้เลย (ลอง Scan ดูได้)
  การทำงานคร่าวๆ คือสร้าง QR Code เป็น Buffer แล้ว Upload ขึ้น Google Cloud Storage ส่งค่ากลับมาเป็น Url และ Reply กลับมาผ่าน Line แสดงเป็นรูปภาพ

![QR Code](/static/images/blog/personal-tool-line/qrcode.png)

<br />

3. **Image to text** - ส่งรูปภาพอะไรไปก็ได้ แล้ว Bot จะตอบกลับมาเป็นข้อความทั้งหมดที่อยู่ในรูปภาพ ความแม่นยำและถูกต้องขึ้นอยู่กับความคมชัดของข้อความในรูปภาพ แต่ถ้าเป็นภาษาไทยประโยคที่ได้จะเว้นเป็นคำๆ 
ไม่ติดกัน ซึ่งผมก็ไม่ทราบว่าเพราะอะไร เพราะการดึงข้อความตรงนี้เราใช้ [Google Cloud Vision AI](https://cloud.google.com/vision)

![QR Code](/static/images/blog/personal-tool-line/imgtotxt1.png)

ซึ่งถ้าเขียนด้วยลายมือ Bot อาจจะอ่านไม่ออกบางคำ จะเห็นตกคำว่า **"เค้าแค่ไม่อยาก"** และคำว่า **"งดรีโพส"** ได้มาเป็น **"งด รีม ส"**

![QR Code](/static/images/blog/personal-tool-line/imgtotxt2.png)

แต่ถ้าเป็นตัวอักษรที่พิมพ์เอาและถ่ายให้ชัดเจน ค่อนข้างจะถูกต้อง 100% นอกจากตัวอักษรนั้นจะเล็กมากๆ 

<br />

<center>. . .</center>

<br />

### Japter (Android Application)

พอผมใช้การบันทึกรายจ่ายผ่่าน LINE ไปสักพัก เริ่มขี้เกียจต้องมาคอยพิมพ์อยู่ทุกครั้ง และผมเองแทบไม่ได้ใช้เงินสดเลย
ส่วนมากจะโอนจ่ายสะมากกว่า ผมเลยสนใจการสร้างแอพตามที่คุณ dtinth ได้บอกไว้ เลยลองเข้าไปดู​ Source code
และเอา Project มารันทดสอบดู ก็ยังงงๆ จับต้นชนปลายไม่ถูกอยู่ดี ทำให้ผมตัดสินใจเขียนขึ้นมาใหม่ตาม Concept 
ที่คุณ dtinth ได้ทำไว้ และตัดส่วนที่เราไม่ต้องการออกไป จนได้ออกเป็นแอพชื่อ **Japter** ซึ่งมาจาก 
ชื่อผมเองตัว **J** และคำว่า **Adapter** เอามารวมกันนั่นเอง

![Japter](/static/images/blog/personal-tool-line/japter.jpg)

การทำงานคือ **Japter** จะคอยดึงข้อมูลการใช้จ่ายจากการแจ้งเตือน และส่งข้อมูลทั้งหมดไปยัง **Jasistant** มีรายละเอียดอังนี้
- สามารถกำหนดได้ว่าแจ้งเตือนเรื่องอะไรบ้างที่เราไม่สนใจ อย่างในรูปผมจะใส่ชื่อ Package ไปเลย

  ![Japter](/static/images/blog/personal-tool-line/japter-block.jpg)

- สามารถดูรายละเอียดการแจ้งเตือนล่าสุดได้

  ![Japter](/static/images/blog/personal-tool-line/japter-history.jpg)

- ระบบจะส่งรายการที่ล้มเหลวแบบอัตโนมัติไปใหม่เรื่อยๆ จนกว่าจะสำเร็จหรือเรายกเลิก
- สามารถดูสถานะต่างๆได้ เช่น สำเร็จแล้วกี่รายการหรืออยู่ในคิวอีกกี่รายการ เป็นต้น

  ![Japter](/static/images/blog/personal-tool-line/japter-status.jpg)

- สามารถยกเลิกทุกรายการที่อยู่ในคิวได้

  ![Japter](/static/images/blog/personal-tool-line/japter-cancel.jpg)

---

## ใช้เทคโนโลยีอะไรบ้าง ?

#### Janalyze
  - [LINE Developers](https://developers.line.biz/en/docs/messaging-api/building-bot/#line-manager-settings) - สร้าง Channel มาเพิ่มชื่อว่า Janalyze และใช้การเชื่อมต่อ Service ผ่าน Webhook ใน Messaging API
  เมื่อเราส่งข้อความอะไรก็ตามใน LINE มันจะวิ่งเข้า URL ที่เรากำหนดไว้ใน Webhook

#### Jasistant
  - [Node.js](https://nodejs.org/en) - ใช้เป็นภาษาหลักสำหรับ Backend Service
  - [Express.js](https://expressjs.com/) - ใช้เป็นเฟรมเวิร์คใน Backend Service
  - [Vercel](https://vercel.com/) - ใช้สำหรับเป็น Server และ Host ให้กับ Backend Service (ฟรี)
  - [Google Cloud Storage](https://cloud.google.com/storage) - สำหรับเก็บไฟล์รูปภาพใช้ใน Backend Service
  - [Google Cloud Vision AI](https://cloud.google.com/vision) - เป็น AI สำหรับอ่านและดึงข้อความจากรูปภาพใช้ใน Backend Service
  - [Airtable](https://www.airtable.com/) - ใช้เป็นฐานข้อมูลให้กับการบันทึกรายจ่าย
  - [promptpay-qr](https://github.com/dtinth/promptpay-qr) - เป็นแพ็คเกจของ NPM ใช้สำหรับสร้าง QR Code แบบพร้อมเพย์
  - [tweetnacl-sealedbox-js](https://www.npmjs.com/package/tweetnacl-sealedbox-js) - เป็นแพ็คเกจของ NPM ใช้สำหรับรับส่งข้อมูลแบบเข้ารหัส เอาไว้ถอดรหัสที่ส่งมาจาก Android

#### Japter
  - [Kotlin](https://kotlinlang.org/) - เป็นภาษาหลักในการเขียน Android
  - [lazysodium-android](https://github.com/terl/lazysodium-android) - ใช้ในการเข้ารหัสสำหรับส่งข้อมูลไปยัง Backend Service
  - [Material](https://developer.android.com/develop/ui/views/theming/look-and-feel) - ใช้เป็น CSS สำหรับ UI